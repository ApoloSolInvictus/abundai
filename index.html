<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ABUNDA PRIME | Investigación Jurídica Avanzada</title>
	
	<link rel="icon" type="image/png" href="/my-favicon/favicon-96x96.png" sizes="96x96" />
    <link rel="icon" type="image/svg+xml" href="/my-favicon/favicon.svg" />
    <link rel="shortcut icon" href="/my-favicon/favicon.ico" />
    <link rel="apple-touch-icon" sizes="180x180" href="/my-favicon/apple-touch-icon.png" />
    <meta name="apple-mobile-web-app-title" content="ProfCR" />
    <link rel="manifest" href="/my-favicon/site.webmanifest" />
	
	<title>ABUNDA AI | Inteligencia Empresarial Segura</title>
    <meta name="description" content="El Sistema Operativo de Conocimiento para empresas modernas. Centraliza documentos, entrena a tu equipo y obtén respuestas instantáneas con IA privada.">
    <meta name="keywords" content="abunda, ai, ia, abunda ai, documents, pdf, llm, ai for documents, ai for business, ai for sme, ai for big companies">
	<link rel="canonical" href="https://ventas.abunda-ai.com/" />
	
	<meta property="og:type" content="website">
    <meta property="og:url" content="https://ventas.abunda-ai.com/">
	<meta property="og:title" content="ABUNDA AI | Inteligencia Empresarial Segura">
    <meta property="og:description" content="El Sistema Operativo de Conocimiento para empresas modernas. Centraliza documentos, entrena a tu equipo y obtén respuestas instantáneas con IA privada.">
    <meta property="og:image" content="https://ventas.abunda-ai.com/images/seo-preview.jpg">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <meta property="og:site_name" content="ABUNDA AI">

    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://ventas.abunda-ai.com/">
    <meta property="twitter:title" content="ABUNDA AI | Inteligencia Empresarial Segura">
    <meta property="twitter:description" content="El Sistema Operativo de Conocimiento para empresas modernas. Centraliza documentos, entrena a tu equipo y obtén respuestas instantáneas con IA privada.">
    <meta property="twitter:image" content="https://ventas.abunda-ai.com/images/seo-preview.jpg">

	<link rel="icon" href="/favicon.ico" sizes="any">
    <link rel="icon" href="/favicon.svg" type="image/svg+xml">
	<link rel="apple-touch-icon" href="/apple-touch-icon.png">
	<meta name="theme-color" content="#ffffff">
    
    <!-- Fuentes: Inter (UI) y Merriweather (Texto Legal) -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Merriweather:ital,wght@0,300;0,400;0,700;0,900;1,300&display=swap" rel="stylesheet">
    
    <!-- Librerías -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <!-- React -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        serif: ['Merriweather', 'serif'],
                    },
                    colors: {
                        legal: {
                            blue: '#003366',    // Azul Tirant/Institucional
                            light: '#F8F9FA',   // Fondo Papel
                            gold: '#C5A028',    // Acento Premium
                            text: '#1F2937',    // Texto Lectura
                            border: '#E2E8F0'
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #F3F4F6; color: #1F2937; }
        
        /* Estilos del Documento Legal Renderizado (Markdown) */
        .legal-content { font-family: 'Merriweather', serif; line-height: 1.8; color: #111827; }
        .legal-content h1 { font-size: 24px; font-weight: 900; margin-bottom: 16px; border-bottom: 2px solid #003366; padding-bottom: 8px; color: #003366; }
        .legal-content h2 { font-size: 20px; font-weight: 700; margin-top: 24px; margin-bottom: 12px; color: #003366; }
        .legal-content h3 { font-size: 18px; font-weight: 600; margin-top: 20px; margin-bottom: 10px; }
        .legal-content p { margin-bottom: 16px; text-align: justify; }
        .legal-content ul, .legal-content ol { margin-bottom: 16px; padding-left: 24px; }
        .legal-content ul { list-style-type: disc; }
        .legal-content li { margin-bottom: 8px; }
        .legal-content strong { color: #000; font-weight: 900; }
        .legal-content blockquote { border-left: 4px solid #C5A028; padding-left: 16px; font-style: italic; color: #4B5563; background: #F8F9FA; padding: 12px; border-radius: 0 8px 8px 0; }

        .fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden">
    <div id="root" class="h-full flex flex-col"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // ==========================================
        // CONFIGURACIÓN TÁCTICA
        // ==========================================
        
        // URL DEL BACKEND EN HEROKU (Backend con main.py de OpenAI)
        const DEFAULT_BACKEND_URL = "https://infinity-1a8b0e60d47c.herokuapp.com"; 

        // CONFIGURACIÓN FIREBASE
        const firebaseConfig = {
            apiKey: "AIzaSyC8Qqq7F1kGvaNlTzL5gRQWTdMBVjuEamQ", 
            authDomain: "abunda-ai.firebaseapp.com",
            projectId: "abunda-ai",
            storageBucket: "abunda-ai.firebasestorage.app",
            messagingSenderId: "G-4XZ8WVKSL1",
            appId: "1:833878539166:web:01a3726d456efd3bbb348f"
        };

        // Inicialización Firebase
        let db = null;
        try {
            if (!firebase.apps.length) firebase.initializeApp(firebaseConfig);
            db = firebase.firestore();
        } catch(e) { console.error("Firebase Error:", e); }

        // ==========================================
        // COMPONENTES
        // ==========================================

        // 1. LOGIN (Estilo Institucional)
        const LoginScreen = ({ onLogin }) => {
            const [email, setEmail] = useState("");
            const [password, setPassword] = useState("");
            const [loading, setLoading] = useState(false);

            const handleLogin = async (e) => {
                e.preventDefault();
                setLoading(true);
                try {
                    const cred = await firebase.auth().signInWithEmailAndPassword(email, password);
                    onLogin(cred.user);
                } catch (error) {
                    alert("Error de credenciales. Intente nuevamente.");
                    setLoading(false);
                }
            };

            return (
                <div className="w-full h-full flex items-center justify-center bg-gray-100">
                    <div className="bg-white p-10 rounded-lg shadow-xl border border-gray-200 w-full max-w-md">
                        <div className="text-center mb-8">
                            <div className="flex justify-center items-center gap-2 mb-2">
                                <i className="ph ph-scales text-4xl text-legal-blue"></i>
                                <span className="font-serif text-3xl font-bold text-legal-blue">Abunda Prime</span>
                            </div>
                            <p className="text-sm text-gray-500 uppercase tracking-widest">Acceso Profesional</p>
                        </div>
                        <form onSubmit={handleLogin} className="space-y-4">
                            <input type="email" value={email} onChange={e=>setEmail(e.target.value)} className="w-full border border-gray-300 rounded p-3 text-gray-800 focus:border-legal-blue outline-none" placeholder="Usuario Corporativo" />
                            <input type="password" value={password} onChange={e=>setPassword(e.target.value)} className="w-full border border-gray-300 rounded p-3 text-gray-800 focus:border-legal-blue outline-none" placeholder="Contraseña" />
                            <button disabled={loading} className="w-full bg-legal-blue hover:bg-blue-800 text-white font-bold py-3 rounded transition shadow-md">
                                {loading ? "Verificando..." : "Ingresar"}
                            </button>
                        </form>
                        <p className="text-xs text-center text-gray-400 mt-6">© 2026 Abunda Legal Tech. Todos los derechos reservados.</p>
                    </div>
                </div>
            );
        };

        // 2. INTERFAZ PRINCIPAL
        const MainApp = ({ user, onLogout }) => {
            const [query, setQuery] = useState("");
            const [loading, setLoading] = useState(false);
            const [result, setResult] = useState(null);
            const [history, setHistory] = useState([]);
            
            // Función de Búsqueda
            const handleSearch = async () => {
                if(!query.trim()) return;
                setLoading(true);
                setResult(null); // Limpiar vista anterior

                const newHistoryItem = { role: 'user', content: query };
                setHistory(prev => [...prev, newHistoryItem]);

                try {
                    const response = await fetch(`${DEFAULT_BACKEND_URL}/api/chat`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ 
                            message: query,
                            history: history.slice(-4) // Contexto de conversación corta
                        })
                    });

                    if(!response.ok) throw new Error("Error en el servidor jurídico");

                    const data = await response.json();
                    
                    // Renderizar Markdown a HTML
                    const htmlContent = marked.parse(data.response);
                    
                    setResult({ content: htmlContent, query: query, date: new Date().toLocaleDateString() });
                    setHistory(prev => [...prev, { role: 'ai', content: data.response }]);

                } catch (e) {
                    alert("Error de conexión: " + e.message);
                } finally {
                    setLoading(false);
                }
            };

            const exportPDF = () => {
                const element = document.getElementById('document-print');
                const opt = {
                    margin: 20,
                    filename: 'Dictamen_Abunda_Prime.pdf',
                    image: { type: 'jpeg', quality: 0.98 },
                    html2canvas: { scale: 2 },
                    jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
                };
                html2pdf().set(opt).from(element).save();
            };

            return (
                <div className="flex h-full bg-white">
                    
                    {/* SIDEBAR (MENÚ) */}
                    <aside className="w-64 bg-legal-blue text-white flex flex-col hidden md:flex shadow-2xl z-20">
                        <div className="h-16 flex items-center px-6 border-b border-blue-800 bg-blue-900">
                            <span className="font-serif font-bold text-lg">ABUNDA PRIME</span>
                        </div>
                        
                        <nav className="flex-1 p-4 space-y-2">
                            <a href="#" onClick={() => setResult(null)} className="flex items-center gap-3 px-4 py-3 bg-blue-800 rounded-lg text-sm font-medium hover:bg-blue-700 transition">
                                <i className="ph ph-magnifying-glass text-lg"></i> Nueva Búsqueda
                            </a>
                            <a href="#" className="flex items-center gap-3 px-4 py-3 text-blue-200 hover:text-white hover:bg-blue-800 rounded-lg text-sm font-medium transition">
                                <i className="ph ph-folder-open text-lg"></i> Mis Expedientes
                            </a>
                            <a href="#" className="flex items-center gap-3 px-4 py-3 text-blue-200 hover:text-white hover:bg-blue-800 rounded-lg text-sm font-medium transition">
                                <i className="ph ph-bookmark text-lg"></i> Favoritos
                            </a>
                            
                            <div className="mt-8">
                                <p className="text-xs text-blue-400 uppercase font-bold px-2 mb-2">Historial Reciente</p>
                                {history.filter(h => h.role === 'user').slice().reverse().slice(0,5).map((h,i) => (
                                    <div key={i} className="px-3 py-2 text-xs text-blue-100 truncate hover:bg-blue-800 rounded cursor-pointer border-l-2 border-transparent hover:border-legal-gold">
                                        {h.content}
                                    </div>
                                ))}
                            </div>
                        </nav>

                        <div className="p-4 border-t border-blue-800">
                            <div className="flex items-center gap-2 mb-2">
                                <div className="w-8 h-8 rounded-full bg-legal-gold text-blue-900 flex items-center justify-center font-bold text-xs">{user.email[0].toUpperCase()}</div>
                                <div className="overflow-hidden">
                                    <p className="text-xs font-bold truncate">{user.email}</p>
                                    <p className="text-[10px] text-green-400">Licencia Premium</p>
                                </div>
                            </div>
                            <button onClick={onLogout} className="w-full text-xs text-center text-blue-300 hover:text-white py-1">Cerrar Sesión</button>
                        </div>
                    </aside>

                    {/* MAIN CONTENT */}
                    <div className="flex-1 flex flex-col h-full overflow-hidden bg-gray-50 relative">
                        
                        {/* HEADER BAR */}
                        <header className="h-16 bg-white border-b border-gray-200 flex items-center justify-between px-8 shadow-sm z-10">
                            <h2 className="text-gray-700 font-serif font-bold text-lg">Investigación Jurídica</h2>
                            <div className="flex gap-4 text-gray-500">
                                <button className="hover:text-legal-blue"><i className="ph ph-bell text-xl"></i></button>
                                <button className="hover:text-legal-blue"><i className="ph ph-gear text-xl"></i></button>
                            </div>
                        </header>

                        {/* WORKSPACE */}
                        <div className="flex-1 overflow-y-auto p-8">
                            
                            {/* SEARCH BAR SECTION */}
                            <div className={`transition-all duration-500 ${result ? 'mb-8' : 'h-full flex flex-col justify-center items-center -mt-20'}`}>
                                {!result && (
                                    <div className="text-center mb-8 fade-in">
                                        <i className="ph ph-scales text-6xl text-gray-300 mb-4"></i>
                                        <h1 className="text-3xl font-serif font-bold text-legal-blue mb-2">¿Qué desea investigar hoy?</h1>
                                        <p className="text-gray-500">Búsqueda inteligente en legislación y jurisprudencia.</p>
                                    </div>
                                )}

                                <div className="w-full max-w-3xl bg-white rounded-lg shadow-lg border border-gray-200 flex p-2 relative group focus-within:ring-2 focus-within:ring-legal-blue focus-within:border-transparent">
                                    <input 
                                        type="text" 
                                        value={query}
                                        onChange={e => setQuery(e.target.value)}
                                        onKeyPress={e => e.key === 'Enter' && handleSearch()}
                                        className="flex-1 p-3 outline-none text-gray-700 placeholder-gray-400 font-serif"
                                        placeholder="Ej: Requisitos para divorcio por mutuo acuerdo en Costa Rica..."
                                        autoFocus
                                    />
                                    <button 
                                        onClick={handleSearch}
                                        disabled={loading}
                                        className="bg-legal-blue hover:bg-blue-800 text-white px-6 py-2 rounded font-bold transition flex items-center gap-2"
                                    >
                                        {loading ? <i className="ph ph-spinner animate-spin"></i> : <i className="ph ph-magnifying-glass"></i>}
                                        Buscar
                                    </button>
                                </div>
                                
                                {!result && (
                                    <div className="mt-6 flex gap-3 justify-center text-sm text-gray-500 font-medium">
                                        <span className="cursor-pointer hover:text-legal-blue hover:underline" onClick={()=>setQuery("Artículo 33 Constitución Política")}>Art. 33 Constitución</span> •
                                        <span className="cursor-pointer hover:text-legal-blue hover:underline" onClick={()=>setQuery("Código de Trabajo Despido")}>Código Trabajo</span> •
                                        <span className="cursor-pointer hover:text-legal-blue hover:underline" onClick={()=>setQuery("Ley 7600 Costa Rica")}>Ley 7600</span>
                                    </div>
                                )}
                            </div>

                            {/* RESULTS SECTION */}
                            {loading && !result && (
                                <div className="text-center py-10 fade-in">
                                    <div className="inline-block animate-spin rounded-full h-8 w-8 border-4 border-legal-blue border-t-transparent mb-4"></div>
                                    <p className="text-gray-500 font-serif">Analizando bases de datos jurídicas...</p>
                                </div>
                            )}

                            {result && (
                                <div className="max-w-4xl mx-auto fade-in">
                                    <div className="flex justify-between items-center mb-4">
                                        <div className="flex items-center gap-2">
                                            <span className="bg-green-100 text-green-800 text-xs font-bold px-2 py-1 rounded border border-green-200">DICTAMEN GENERADO</span>
                                            <span className="text-xs text-gray-500">{result.date}</span>
                                        </div>
                                        <div className="flex gap-2">
                                            <button onClick={() => {navigator.clipboard.writeText(result.content); alert("Texto copiado");}} className="p-2 bg-white border border-gray-300 rounded hover:bg-gray-50 text-gray-600" title="Copiar"><i className="ph ph-copy"></i></button>
                                            <button onClick={exportPDF} className="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-bold rounded flex items-center gap-2 shadow-sm">
                                                <i className="ph ph-file-pdf"></i> Guardar PDF
                                            </button>
                                        </div>
                                    </div>

                                    <div id="document-print" className="bg-white p-16 shadow-lg border border-gray-200 min-h-[800px]">
                                        {/* Membrete Documento */}
                                        <div className="border-b-2 border-legal-blue pb-4 mb-8 flex justify-between items-end">
                                            <div>
                                                <h1 className="font-serif font-bold text-2xl text-legal-blue">INFORME JURÍDICO</h1>
                                                <p className="text-xs text-gray-500 mt-1 uppercase tracking-wide">Ref: {result.query}</p>
                                            </div>
                                            <div className="text-right">
                                                <i className="ph ph-scales text-3xl text-legal-gold"></i>
                                            </div>
                                        </div>

                                        {/* Contenido */}
                                        <div className="legal-content" dangerouslySetInnerHTML={{__html: result.content}}></div>

                                        {/* Pie */}
                                        <div className="mt-16 pt-8 border-t border-gray-200 text-center text-xs text-gray-400 font-serif italic">
                                            Documento generado por Inteligencia Artificial Abunda Prime. Información con fines de referencia jurídica.
                                        </div>
                                    </div>
                                </div>
                            )}

                        </div>
                    </div>
                </div>
            );
        };

        const App = () => {
            const [user, setUser] = useState(null);
            useEffect(() => {
                firebase.auth().onAuthStateChanged(u => setUser(u || null));
            }, []);
            const handleLogout = async () => { await firebase.auth().signOut(); };
            return <React.Fragment>{!user ? <LoginScreen onLogin={setUser} /> : <MainApp user={user} onLogout={handleLogout} />}</React.Fragment>;
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
